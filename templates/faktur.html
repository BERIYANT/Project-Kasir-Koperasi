<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Struk {{ tipe|capitalize }} - {{ nomor_faktur }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Helvetica', sans-serif;
            background-color: #f5f5f5;
            padding: 10px;
        }

        .struk-container {
            width: 58mm;
            max-width: 220px;
            margin: 0 auto;
            background: white;
            padding: 2mm 1mm;
            font-size: 10pt;
            line-height: 1.1;
        }

        .text-center {
            text-align: center;
        }

        /* Header */
        .header {
            text-align: center;
            border-bottom: 2px dashed #000;
            padding-bottom: 3px;
            margin-bottom: 3px;
        }

        .header .company {
            font-size: 13pt;
            font-weight: 900;
            margin-bottom: 1px;
        }

        .header .info {
            font-size: 8pt;
            margin-top: 1px;
            line-height: 1.1;
            font-weight: 500;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 3px 8px;
            background: #000;
            color: #fff;
            font-size: 9pt;
            font-weight: 900;
            margin: 3px 0;
            letter-spacing: 0.8px;
        }

        /* Info Section */
        .section {
            margin: 3px 0;
            font-size: 9pt;
            line-height: 1.3;
        }

        .section div {
            margin: 1px 0;
            font-weight: 500;
        }

        .section strong {
            font-weight: 900;
        }

        /* Divider */
        .divider {
            border-top: 2px dashed #000;
            margin: 3px 0;
        }

        .divider-solid {
            border-top: 2px solid #000;
            margin: 3px 0;
        }

        /* Item Row */
        .item-row {
            margin: 1px 0;
        }

        .item-name {
            font-size: 9pt;
            font-weight: 900;
            margin-bottom: 0;
        }

        /* Tambahan: Sub Item */
        .sub-items {
            margin-left: 7px;
            font-size: 7pt;
            color: #444;
            font-weight: 500;
            margin-bottom: 0;
            line-height: 1.1;
        }

        .sub-items span {
            display: block;
            margin-bottom: 0;
        }

        .item-detail {
            display: flex;
            justify-content: space-between;
            font-size: 9pt;
            font-weight: 600;
        }

        /* Summary */
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin: 2px 0;
            font-size: 9pt;
            font-weight: 600;
        }

        /* Total */
        .total-row {
            display: flex;
            justify-content: space-between;
            font-weight: 900;
            font-size: 12pt;
            margin: 4px 0;
            padding: 3px 0;
            border-top: 3px solid #000;
            border-bottom: 3px solid #000;
        }

        /* Payment */
        .payment-row {
            display: flex;
            justify-content: space-between;
            margin: 2px 0;
            font-size: 9pt;
            font-weight: 600;
        }

        .payment-row.change {
            font-weight: 900;
            font-size: 11pt;
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 2px;
            padding-top: 2px;
            border-top: 2px dashed #000;
            font-size: 8pt;
            line-height: 1.1;
            padding-bottom: 0;
        }

        .footer .thanks {
            font-weight: 900;
            font-size: 10pt;
            margin: 2px 0;
        }

        .footer .note {
            font-size: 7pt;
            margin: 1px 0;
            font-weight: 500;
        }

        /* Terbilang */
        .terbilang {
            font-size: 7pt;
            text-align: center;
            font-style: italic;
            margin: 3px 0;
            line-height: 1.2;
            font-weight: 600;
        }

        /* Print Buttons */
        .no-print {
            text-align: center;
            margin-bottom: 15px;
        }

        .btn-print {
            background-color: #2d7a4f;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .btn-print:hover {
            background-color: #1a5738;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-back {
            background-color: #666;
        }

        .btn-back:hover {
            background-color: #444;
        }

        /* Spacer untuk kertas naik */
        .spacer {
            height: 5mm;
        }

        /* Print Settings */
        @media print {
            body {
                background: white;
                padding: 0;
                margin: 0;
            }

            .struk-container {
                width: 58mm;
                max-width: 58mm;
                padding: 1mm 0.5mm;
                margin: 0;
            }

            .no-print {
                display: none !important;
            }

            @page {
                size: 58mm auto;
                margin: 0mm;
            }

            * {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            body {
                font-family: 'Arial', 'Helvetica', sans-serif;
            }

            /* Font Tebal dan Ukuran Optimal */
            .header .company {
                font-size: 14pt !important;
                font-weight: 900 !important;
                -webkit-text-stroke: 0.3px black;
            }

            .header .info {
                font-size: 9pt !important;
                font-weight: 700 !important;
            }

            .badge {
                background: #000 !important;
                color: #fff !important;
                font-weight: 900 !important;
                font-size: 10pt !important;
                -webkit-text-stroke: 0.2px white;
            }

            .section {
                font-size: 10pt !important;
            }

            .section strong {
                font-weight: 900 !important;
                -webkit-text-stroke: 0.2px black;
            }

            .section div {
                font-weight: 700 !important;
            }

            .item-name {
                font-size: 10pt !important;
                font-weight: 900 !important;
                -webkit-text-stroke: 0.2px black;
            }

            .item-detail {
                font-size: 10pt !important;
                font-weight: 700 !important;
            }

            .summary-row {
                font-size: 10pt !important;
                font-weight: 700 !important;
            }

            .total-row {
                font-size: 13pt !important;
                font-weight: 900 !important;
                border-top: 3px solid #000 !important;
                border-bottom: 3px solid #000 !important;
                -webkit-text-stroke: 0.3px black;
            }

            .payment-row {
                font-size: 10pt !important;
                font-weight: 700 !important;
            }

            .payment-row.change {
                font-size: 12pt !important;
                font-weight: 900 !important;
                -webkit-text-stroke: 0.3px black;
            }

            .terbilang {
                font-size: 8pt !important;
                font-weight: 700 !important;
            }

            .footer .thanks {
                font-size: 11pt !important;
                font-weight: 900 !important;
                -webkit-text-stroke: 0.3px black;
            }

            .footer .note {
                font-size: 8pt !important;
                font-weight: 700 !important;
                color: #000 !important;
            }

            .footer {
                padding-bottom: 0 !important;
                margin-top: 2px !important;
            }

            .spacer {
                height: 2mm !important;
            }

            /* Border */
            .divider,
            .header {
                border-top: 2px dashed #000 !important;
                border-bottom: 2px dashed #000 !important;
            }

            .divider-solid {
                border-top: 2px solid #000 !important;
            }

            .footer {
                border-top: 2px dashed #000 !important;
            }

            /* Warna hitam pekat */
            * {
                color: #000 !important;
            }

            .badge {
                color: #fff !important;
            }

            /* Tambahan: Sub Item Print */
            .sub-items {
                font-size: 7pt !important;
                color: #000 !important;
                margin-left: 7px !important;
                font-weight: 600 !important;
                line-height: 1.1 !important;
                margin-bottom: 0 !important;
            }
        }
    </style>
</head>
<body>
    <!-- Print Buttons -->
    <div class="no-print">
        <button class="btn-print" onclick="window.print()">üñ®Ô∏è Cetak Struk</button>
        <button class="btn-print btn-back" onclick="window.history.back()">‚Üê Kembali</button>
    </div>

    <!-- Struk Container -->
    <div class="struk-container">
        <!-- Header -->
        <div class="header">
            <div class="company">KOPERASI SEJAHTERA</div>
            <div class="info">Jl. Makmur Sentosa No. 123</div>
            <div class="info">Jakarta Selatan 12345</div>
            <div class="info">Telp: (021) 1234-5678</div>
        </div>

        <!-- Badge -->
        <div class="text-center">
            <div class="badge">{{ tipe|upper }}</div>
        </div>

        <!-- Info Transaksi -->
        <div class="section">
            <div><strong>No. Faktur:</strong> 
                {% if nomor_faktur %}
                    {% if nomor_faktur.startswith('FKT-JUA-') %}
                        {# Konversi FKT-JUA-YYYYMMDDHHMMSS ke jYYMMDDHHMMSSxxx #}
                        {% set fak_dt = nomor_faktur[8:] %}
                        {% set fak_tahun = fak_dt[2:4] %}
                        {% set kode_faktur = 'j' + fak_tahun + fak_dt[4:] %}
                        {{ kode_faktur }}
                    {% elif nomor_faktur.startswith('FKT-BEL-') %}
                        {# Konversi FKT-BEL-YYYYMMDDHHMMSS ke bYYMMDDHHMMSSxxx #}
                        {% set fak_dt = nomor_faktur[8:] %}
                        {% set fak_tahun = fak_dt[2:4] %}
                        {% set kode_faktur = 'b' + fak_tahun + fak_dt[4:] %}
                        {{ kode_faktur }}
                    {% else %}
                        {{ nomor_faktur }}
                    {% endif %}
                {% else %}
                    -
                {% endif %}
            </div>
            <div><strong>Tanggal:</strong> {{ tanggal }}</div>
            {% if nama_petugas %}
            <div><strong>Kasir:</strong> {{ nama_petugas }}</div>
            {% endif %}
            {% if kepada and kepada != 'Customer' and kepada != 'Supplier' and kepada != '-' %}
            <div><strong>{% if tipe == 'pembelian' %}Supplier{% else %}Pelanggan{% endif %}:</strong> {{ kepada }}</div>
            {% endif %}
        </div>

        <div class="divider-solid"></div>

        <!-- Daftar Barang -->
        {% for item in items %}
        <div class="item-row">
            <div class="item-name">
                [{% if item.kode %}{{ item.kode }}{% else %}‚Äî{% endif %}] {{ item.nama[:24] }}
            </div>
            {# Tampilkan sub item jika ada #}
            {% if item.sub_items %}
            <div class="sub-items">
                {% for sub in item.sub_items %}
                    {% if sub.nama is defined and sub.jumlah is defined and sub.harga is defined %}
                        <span>- {{ sub.nama }} x {{ sub.jumlah }} x Rp{{ "{:,}".format(sub.harga|int).replace(',', '.') }}</span>
                    {% else %}
                        <span>- {{ sub }}</span>
                    {% endif %}
                {% endfor %}
            </div>
            {% endif %}
            <div class="item-detail">
                <span>{{ item.jumlah }} x Rp{{ "{:,}".format(item.harga|int).replace(',', '.') }}</span>
                <span>Rp{{ "{:,}".format(item.subtotal|int).replace(',', '.') }}</span>
            </div>
            <div style="font-size:8pt;font-weight:600;">
                Subtotal: {{ item.jumlah }} pcs
            </div>
        </div>
        {% endfor %}

        <div class="divider"></div>

        <!-- Summary -->
        <div class="summary-row">
            <span>Subtotal</span>
            <span>Rp{{ "{:,}".format(total|int).replace(',', '.') }}</span>
        </div>

        {% if total_pajak and total_pajak > 0 %}
        <div class="summary-row">
            <span>Pajak</span>
            <span>Rp{{ "{:,}".format(total_pajak|int).replace(',', '.') }}</span>
        </div>
        {% endif %}

        {% if biaya_kirim and biaya_kirim > 0 %}
        <div class="summary-row">
            <span>Ongkir</span>
            <span>Rp{{ "{:,}".format(biaya_kirim|int).replace(',', '.') }}</span>
        </div>
        {% endif %}

        <!-- Total -->
        <div class="total-row">
            <span>TOTAL</span>
            <span>Rp{{ "{:,}".format(total|int).replace(',', '.') }}</span>
        </div>

        <!-- Payment -->
        {% if dibayar and dibayar > 0 %}
        <div class="payment-row">
            <span>Dibayar</span>
            <span>Rp{{ "{:,}".format(dibayar|int).replace(',', '.') }}</span>
        </div>
        {% endif %}

        {% if saldo and saldo != 0 %}
        <div class="payment-row change">
            <span>Kembali</span>
            <span>Rp{{ "{:,}".format(saldo|int).replace(',', '.') }}</span>
        </div>
        {% endif %}

        <!-- Terbilang -->
        {% if terbilang %}
        <div class="divider"></div>
        <div class="terbilang"># {{ terbilang }} #</div>
        {% endif %}

        <!-- Footer -->
        <div class="footer">
            <div class="thanks">*** TERIMA KASIH ***</div>
            <div class="note">Barang yang sudah dibeli tidak dapat dikembalikan</div>
        </div>

        <!-- Spacer untuk kertas naik -->
        <div class="spacer"></div>
    </div>
</body>
</html>